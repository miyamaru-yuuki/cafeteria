<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes">
    <title>メニュー選択画面</title>
    <style>
    </style>
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript">
        $(function() {
            function showMenu() {
                $.ajax({
                    url: "/api/cafeteria/",
                    type: "GET",
                    async: true,
                    data: null,
                    dataType: "json",
                    success: function (json){
                        menuData = json.menuData;
                        menuData.forEach(function (data) {
                            data.kosu = 0;
                        });
                    },
                    error: function () {
                        alertError()
                    }
                });
            }

            function alertError(){
                alert('http通信に失敗しました');
            }

            $('#fm1').submit(function(){
                var kid = $('input[name="kid"]').val();
                $('#menu').show();
                $('#fm1').hide();
                menuData.forEach(function (data) {
                    $("#menu").append('<div><a class="menulink" href="' +data.mid+ '">' +data.mname+ '</a></div>')
                });
                return false;
            });

            $('#fm2').submit(function(){
                kosu = 0;
                kosu = kosu + parseInt($('input[name="kosu"]').val(), 10);
                $('#menu2').empty();
                menuData.forEach(function (data) {
                    if(mid == data.mid){
                        if(data.kosu){
                            data.kosu = data.kosu + kosu;
                        }else{
                            data.kosu = kosu;
                        }
                    }
                    $("#menu2").append('<div>' +data.mname+ ':' + data.kosu+ '</p>')
                });
                return false;
            });

            $(document).on("click",".menulink",function(){
                mid = $(this).attr("href");
                mname = $(this).text();
                $('#mname').text(mname);
                $('#fm2').show();

                if ($('#menu2').is(':hidden')) {
                    // 非表示の場合の処理
                    menuData.forEach(function (data) {
                        $("#menu2").append('<div>' +data.mname+ '</div>')
                    });
                }
                $('#fm3').show();
                $('#kingaku').show();
                return false;
            });

            var mid;
            var kosu = 0;
            $('#menu').hide();
            $('#fm2').hide();
            $('#fm3').hide();
            $('#kingaku').hide();
            showMenu();
        })
    </script>
</head>
<body>
<header>
    <h1>メニュー選択画面</h1>
</header>
<nav>
</nav>
<main>
    <form id="fm1">
        <p>会員ID：<input type="number" name="kid"></p>
        <input type="submit" value="ログイン">
    </form>
    <div name="menu" id="menu">
    </div>
    <form id="fm2">
        <div id="mname"></div>
        <p>個数：<input type="number" name="kosu"></p>
        <input type="submit" value="確定">
    </form>
    <div name="kosu" id="kosu"></div>
    <div name="menu2" id="menu2">
    </div>
    <form id="fm3">
        <input type="submit" value="注文">
    </form>
    <div name="menu" id="kingaku">
        <p>合計金額：<input type="number" name="kingaku"></p>
    </div>
    </div>
</main>
<footer>
</footer>
</div>
</body>
</html>
